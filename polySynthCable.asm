.include "tn2313def.inc"

.dseg

t1L: .byte 1
t1H: .byte 1
t1note: .byte 1

t2L: .byte 1
t2H: .byte 1
t2note: .byte 1

t3L: .byte 1
t3H: .byte 1
t3note: .byte 1

t4L: .byte 1
t4H: .byte 1
t4note: .byte 1

t5L: .byte 1
t5H: .byte 1
t5note: .byte 1

t6L: .byte 1
t6H: .byte 1
t6note: .byte 1

.def timersOn=r13



.cseg

	rjmp init

.org $000D ;TIMER0 COMPA
	
	in r21,SREG
	out TCNT0,r14

	


timer1:
	sub r0,r15
	sbc r1,r14
	brne timer2
	
	ldi r16,1<<0
	and r16, timersOn
	out PINB, r16
	
	lds r0, t1L
	lds r1, t1H

timer2:
	sub r2,r15
	sbc r3,r14
	brne timer3
	
	ldi r16,1<<1
	and r16, timersOn
	out PINB, r16
	
	lds r2, t2L
	lds r3, t2H

timer3:
	sub r4,r15
	sbc r5,r14
	brne timer4
	
	ldi r16,1<<2
	and r16, timersOn
	out PINB, r16
	
	lds r4, t3L
	lds r5, t3H

timer4:
	sub r6,r15
	sbc r7,r14
	brne timer5
	
	ldi r16,1<<3
	and r16, timersOn
	out PINB, r16
	
	lds r6, t4L
	lds r7, t4H

timer5:
	sub r8,r15
	sbc r9,r14
	brne timer6
	
	ldi r16,1<<4
	and r16, timersOn
	out PINB, r16
	
	lds r8, t5L
	lds r9, t5H

timer6:
	sub r10,r15
	sbc r11,r14
	brne timer7
	
	ldi r16,1<<5
	and r16, timersOn
	out PINB, r16
	
	lds r10, t6L
	lds r11, t6H

timer7:

	out SREG,r21
	reti



init:

	ldi r16, $FF
	out DDRB, r16
	ldi r16,0
	out PORTB,r16

	ldi r16, 0
	out DDRD, r16
	ldi r16, 1
	out PORTD, r16


	;UART init
    ldi r16,0
    out UBRRH,r16
    ldi r16,39
    out UBRRL,r16

    ldi r16,(1<<RXEN)
    out UCSRB,r16
    
    ldi r16,(1<<UCSZ1|1<<UCSZ0)
    out UCSRC,r16


	ldi r16,(1<<CS00)
	out TCCR0B,r16
	ldi r16,131
	out OCR0A, r16
	ldi r16,1<<OCIE0A
	out TIMSK, r16

	ldi r16,1
	mov r15,r16
	clr r14

	ldi r16,$FF
	mov r1,r16
	mov r3,r16
	mov r5,r16
	mov r7,r16
	mov r9,r16
	mov r11,r16	


	clr timersOn


	sei

main:







	rcall receiveByte


	sbrc r18,7
	mov r20,r18
	

	cpi r20,0b10000000
	brne notNoteOff
	rjmp noteoff
notNoteOff:

	cpi r20,0b10010000
	breq noteon

	cpi r20,0b11100000
	breq pitchBend

	rjmp main



pitchBend:
	sbrc r18,7
	rcall receiveByte
	rcall receiveByte

	lsr r18
	lsr r18
	
	lsr r18
	
	adc r18,r14
	;ldi r19,147

	ldi r19,71

	sub r19,r18
	out OCR0A,r19

	rjmp main




noteon:
	sbrc r18,7
	rcall receiveByte
	mov r19,r18
	rcall receiveByte

	cpi r18,0
	brne notVelZero 
	rjmp noteoffb
notVelZero:

	;turn on notenumber r19
	lsl r19
	ldi ZH, high(noteLookup*2)
	ldi ZL,  low(noteLookup*2)
	add ZL,r19
	

	; find a spare timer
	mov r17,timersOn
	lsr r17
	brcs timer1inUse
	
	ldi r17,1<<0
	cli
	or timersOn,r17
	lpm r1,Z+
	lpm r0,Z
	sts t1H,r1
	sts t1L,r0
	sts t1note,r19
	sei

	rjmp main

timer1inUse:
	lsr r17
	brcs timer2inUse

	ldi r17,1<<1
	cli
	or timersOn,r17
	lpm r3,Z+
	lpm r2,Z
	sts t2H,r3
	sts t2L,r2
	sts t2note,r19
	sei

	rjmp main

timer2inUse:
	lsr r17
	brcs timer3inUse

	ldi r17,1<<2
	cli
	or timersOn,r17
	lpm r5,Z+
	lpm r4,Z
	sts t3H,r5
	sts t3L,r4
	sts t3note,r19
	sei

	rjmp main

timer3inUse:
	lsr r17
	brcs timer4inUse

	ldi r17,1<<3
	cli
	or timersOn,r17
	lpm r7,Z+
	lpm r6,Z
	sts t4H,r7
	sts t4L,r6
	sts t4note,r19
	sei

	rjmp main

timer4inUse:
	lsr r17
	brcs timer5inUse

	ldi r17,1<<4
	cli
	or timersOn,r17
	lpm r9,Z+
	lpm r8,Z
	sts t5H,r9
	sts t5L,r8
	sts t5note,r19
	sei

	rjmp main

timer5inUse:
	lsr r17
	brcs timer6inUse

	ldi r17,1<<5
	cli
	or timersOn,r17
	lpm r11,Z+
	lpm r10,Z
	sts t6H,r11
	sts t6L,r10
	sts t6note,r19
	sei

	rjmp main

timer6inUse:

	rjmp main






noteoff:
	sbrc r18,7
	rcall receiveByte
	mov r19,r18
	rcall receiveByte
noteoffb:

	
	lsl r19

	lds r17,t1note
	cp r17,r19
	brne tryTimer2

	ldi r17,~(1<<0)
	and timersOn,r17
	ldi r17,$FF
	mov r1,r17
	cbi PORTB,0

	rjmp main

tryTimer2:
	lds r17,t2note
	cp r17,r19
	brne tryTimer3

	ldi r17,~(1<<1)
	and timersOn,r17
	ldi r17,$FF
	mov r3,r17
	cbi PORTB,1

	rjmp main

tryTimer3:
	lds r17,t3note
	cp r17,r19
	brne tryTimer4

	ldi r17,~(1<<2)
	and timersOn,r17
	ldi r17,$FF
	mov r5,r17
	cbi PORTB,2

	rjmp main

tryTimer4:
	lds r17,t4note
	cp r17,r19
	brne tryTimer5

	ldi r17,~(1<<3)
	and timersOn,r17
	ldi r17,$FF
	mov r7,r17
	cbi PORTB,3

	rjmp main

tryTimer5:
	lds r17,t5note
	cp r17,r19
	brne tryTimer6

	ldi r17,~(1<<4)
	and timersOn,r17
	ldi r17,$FF
	mov r9,r17
	cbi PORTB,4

	rjmp main

tryTimer6:
	lds r17,t6note
	cp r17,r19
	brne tryTimer7

	ldi r17,~(1<<5)
	and timersOn,r17
	ldi r17,$FF
	mov r11,r17
	cbi PORTB,5

	rjmp main

tryTimer7:

	rjmp main




receiveByte:
    sbis UCSRA,RXC
    rjmp receiveByte
    
    in r18,UDR
    ret


.org 512
noteLookup:    

;.db $3C,$80,$39,$1B,$35,$E6,$32,$E0,$30,$05,$2D,$53,$2A,$C8,$28,$61,$26,$1D,$23,$F9,$21,$F4,$20,$0C,$1E,$40,$1C,$8D,$1A,$F3,$19,$70,$18,$02,$16,$A9,$15,$64,$14,$30,$13,$0E,$11,$FD,$10,$FA,$10,$06,$0F,$20,$0E,$47,$0D,$7A,$0C,$B8,$0C,$01,$0B,$55,$0A,$B2,$0A,$18,$09,$87,$08,$FE,$08,$7D,$08,$03,$07,$90,$07,$23,$06,$BD,$06,$5C,$06,$01,$05,$AA,$05,$59,$05,$0C,$04,$C4,$04,$7F,$04,$3F,$04,$02,$03,$C8,$03,$92,$03,$5E,$03,$2E,$03,$00,$02,$D5,$02,$AC,$02,$86,$02,$62,$02,$40,$02,$1F,$02,$01,$01,$E4,$01,$C9,$01,$AF,$01,$97,$01,$80,$01,$6B,$01,$56,$01,$43,$01,$31,$01,$20,$01,$10,$01,$00,$00,$F2,$00,$E4,$00,$D8,$00,$CB,$00,$C0,$00,$B5,$00,$AB,$00,$A2,$00,$98,$00,$90,$00,$88,$00,$80,$00,$79,$00,$72,$00,$6C,$00,$66,$00,$60,$00,$5B,$00,$56,$00,$51,$00,$4C,$00,$48,$00,$44,$00,$40,$00,$3D,$00,$39,$00,$36,$00,$33,$00,$30,$00,$2D,$00,$2B,$00,$28,$00,$26,$00,$24,$00,$22,$00,$20,$00,$1E,$00,$1D,$00,$1B,$00,$19,$00,$18,$00,$17,$00,$15,$00,$14,$00,$13,$00,$12,$00,$11,$00,$10
;j=14
;.db $43,$E9,$40,$19,$3C,$80,$39,$1B,$35,$E6,$32,$E0,$30,$05,$2D,$53,$2A,$C8,$28,$61,$26,$1D,$23,$F9,$21,$F4,$20,$0C,$1E,$40,$1C,$8D,$1A,$F3,$19,$70,$18,$02,$16,$A9,$15,$64,$14,$30,$13,$0E,$11,$FD,$10,$FA,$10,$06,$0F,$20,$0E,$47,$0D,$7A,$0C,$B8,$0C,$01,$0B,$55,$0A,$B2,$0A,$18,$09,$87,$08,$FE,$08,$7D,$08,$03,$07,$90,$07,$23,$06,$BD,$06,$5C,$06,$01,$05,$AA,$05,$59,$05,$0C,$04,$C4,$04,$7F,$04,$3F,$04,$02,$03,$C8,$03,$92,$03,$5E,$03,$2E,$03,$00,$02,$D5,$02,$AC,$02,$86,$02,$62,$02,$40,$02,$1F,$02,$01,$01,$E4,$01,$C9,$01,$AF,$01,$97,$01,$80,$01,$6B,$01,$56,$01,$43,$01,$31,$01,$20,$01,$10,$01,$00,$00,$F2,$00,$E4,$00,$D8,$00,$CB,$00,$C0,$00,$B5,$00,$AB,$00,$A2,$00,$98,$00,$90,$00,$88,$00,$80,$00,$79,$00,$72,$00,$6C,$00,$66,$00,$60,$00,$5B,$00,$56,$00,$51,$00,$4C,$00,$48,$00,$44,$00,$40,$00,$3D,$00,$39,$00,$36,$00,$33,$00,$30,$00,$2D,$00,$2B,$00,$28,$00,$26,$00,$24,$00,$22,$00,$20
;j=13
;.db $44,$31,$40,$5D,$3C,$C0,$39,$57,$36,$1F,$33,$16,$30,$38,$2D,$83,$2A,$F5,$28,$8C,$26,$45,$24,$1F,$22,$18,$20,$2E,$1E,$60,$1C,$AC,$1B,$10,$19,$8B,$18,$1C,$16,$C1,$15,$7A,$14,$46,$13,$23,$12,$10,$11,$0C,$10,$17,$0F,$30,$0E,$56,$0D,$88,$0C,$C5,$0C,$0E,$0B,$61,$0A,$BD,$0A,$23,$09,$91,$09,$08,$08,$86,$08,$0C,$07,$98,$07,$2B,$06,$C4,$06,$63,$06,$07,$05,$B0,$05,$5F,$05,$11,$04,$C9,$04,$84,$04,$43,$04,$06,$03,$CC,$03,$95,$03,$62,$03,$31,$03,$03,$02,$D8,$02,$AF,$02,$89,$02,$64,$02,$42,$02,$22,$02,$03,$01,$E6,$01,$CB,$01,$B1,$01,$99,$01,$82,$01,$6C,$01,$58,$01,$44,$01,$32,$01,$21,$01,$11,$01,$01,$00,$F3,$00,$E5,$00,$D8,$00,$CC,$00,$C1,$00,$B6,$00,$AC,$00,$A2,$00,$99,$00,$90,$00,$88,$00,$81,$00,$7A,$00,$73,$00,$6C,$00,$66,$00,$60,$00,$5B,$00,$56,$00,$51,$00,$4D,$00,$48,$00,$44,$00,$40,$00,$3D,$00,$39,$00,$36,$00,$33,$00,$30,$00,$2E,$00,$2B,$00,$29,$00,$26,$00,$24,$00,$22,$00,$20
;j=12
;.db $44,$78,$40,$A1,$3D,$00,$39,$94,$36,$58,$33,$4B,$30,$6A,$2D,$B3,$2B,$22,$28,$B6,$26,$6D,$24,$45,$22,$3C,$20,$50,$1E,$80,$1C,$CA,$1B,$2C,$19,$A6,$18,$35,$16,$D9,$15,$91,$14,$5B,$13,$37,$12,$23,$11,$1E,$10,$28,$0F,$40,$0E,$65,$0D,$96,$0C,$D3,$0C,$1B,$0B,$6D,$0A,$C9,$0A,$2E,$09,$9B,$09,$11,$08,$8F,$08,$14,$07,$A0,$07,$32,$06,$CB,$06,$69,$06,$0D,$05,$B6,$05,$64,$05,$17,$04,$CE,$04,$89,$04,$48,$04,$0A,$03,$D0,$03,$99,$03,$66,$03,$35,$03,$07,$02,$DB,$02,$B2,$02,$8B,$02,$67,$02,$44,$02,$24,$02,$05,$01,$E8,$01,$CD,$01,$B3,$01,$9A,$01,$83,$01,$6E,$01,$59,$01,$46,$01,$33,$01,$22,$01,$12,$01,$03,$00,$F4,$00,$E6,$00,$D9,$00,$CD,$00,$C2,$00,$B7,$00,$AD,$00,$A3,$00,$9A,$00,$91,$00,$89,$00,$81,$00,$7A,$00,$73,$00,$6D,$00,$67,$00,$61,$00,$5B,$00,$56,$00,$51,$00,$4D,$00,$49,$00,$44,$00,$41,$00,$3D,$00,$3A,$00,$36,$00,$33,$00,$30,$00,$2E,$00,$2B,$00,$29,$00,$26,$00,$24,$00,$22,$00,$20,$00,$1F,$00,$1D,$00,$1B,$00,$1A,$00,$18,$00,$17,$00,$16,$00,$14,$00,$13,$00,$12,$00,$11,$00,$10
;j=11
;.db $44,$C0,$40,$E4,$3D,$40,$39,$D0,$36,$91,$33,$81,$30,$9D,$2D,$E3,$2B,$4F,$28,$E1,$26,$96,$24,$6B,$22,$60,$20,$72,$1E,$A0,$1C,$E8,$1B,$49,$19,$C1,$18,$4F,$16,$F1,$15,$A8,$14,$71,$13,$4B,$12,$36,$11,$30,$10,$39,$0F,$50,$0E,$74,$0D,$A4,$0C,$E0,$0C,$27,$0B,$79,$0A,$D4,$0A,$38,$09,$A5,$09,$1B,$08,$98,$08,$1D,$07,$A8,$07,$3A,$06,$D2,$06,$70,$06,$14,$05,$BC,$05,$6A,$05,$1C,$04,$D3,$04,$8D,$04,$4C,$04,$0E,$03,$D4,$03,$9D,$03,$69,$03,$38,$03,$0A,$02,$DE,$02,$B5,$02,$8E,$02,$69,$02,$47,$02,$26,$02,$07,$01,$EA,$01,$CE,$01,$B5,$01,$9C,$01,$85,$01,$6F,$01,$5A,$01,$47,$01,$35,$01,$23,$01,$13,$01,$04,$00,$F5,$00,$E7,$00,$DA,$00,$CE,$00,$C2,$00,$B8,$00,$AD,$00,$A4,$00,$9A,$00,$92,$00,$8A,$00,$82,$00,$7B,$00,$74,$00,$6D,$00,$67,$00,$61,$00,$5C,$00,$57,$00,$52,$00,$4D,$00,$49,$00,$45,$00,$41,$00,$3D,$00,$3A,$00,$37,$00,$34,$00,$31,$00,$2E,$00,$2B,$00,$29,$00,$27,$00,$24,$00,$22,$00,$20,$00,$1F,$00,$1D,$00,$1B,$00,$1A,$00,$18,$00,$17,$00,$16,$00,$14,$00,$13,$00,$12,$00,$11,$00,$10
;j=10
;.db $45,$08,$41,$28,$3D,$80,$3A,$0C,$36,$CA,$33,$B7,$30,$D0,$2E,$13,$2B,$7D,$29,$0C,$26,$BE,$24,$91,$22,$84,$20,$94,$1E,$C0,$1D,$06,$1B,$65,$19,$DC,$18,$68,$17,$09,$15,$BE,$14,$86,$13,$5F,$12,$49,$11,$42,$10,$4A,$0F,$60,$0E,$83,$0D,$B3,$0C,$EE,$0C,$34,$0B,$85,$0A,$DF,$0A,$43,$09,$B0,$09,$24,$08,$A1,$08,$25,$07,$B0,$07,$42,$06,$D9,$06,$77,$06,$1A,$05,$C2,$05,$70,$05,$21,$04,$D8,$04,$92,$04,$51,$04,$13,$03,$D8,$03,$A1,$03,$6D,$03,$3B,$03,$0D,$02,$E1,$02,$B8,$02,$91,$02,$6C,$02,$49,$02,$28,$02,$09,$01,$EC,$01,$D0,$01,$B6,$01,$9E,$01,$87,$01,$71,$01,$5C,$01,$48,$01,$36,$01,$25,$01,$14,$01,$05,$00,$F6,$00,$E8,$00,$DB,$00,$CF,$00,$C3,$00,$B8,$00,$AE,$00,$A4,$00,$9B,$00,$92,$00,$8A,$00,$82,$00,$7B,$00,$74,$00,$6E,$00,$67,$00,$62,$00,$5C,$00,$57,$00,$52,$00,$4D,$00,$49,$00,$45,$00,$41,$00,$3E,$00,$3A,$00,$37,$00,$34,$00,$31,$00,$2E,$00,$2B,$00,$29,$00,$27,$00,$25,$00,$23,$00,$21
;j=7
;.db $45,$E0,$41,$F4,$3E,$40,$3A,$C2,$37,$75,$34,$59,$31,$68,$2E,$A3,$2C,$04,$29,$8C,$27,$37,$25,$04,$22,$F0,$20,$FA,$1F,$20,$1D,$61,$1B,$BB,$1A,$2C,$18,$B4,$17,$51,$16,$02,$14,$C6,$13,$9C,$12,$82,$11,$78,$10,$7D,$0F,$90,$0E,$B0,$0D,$DD,$0D,$16,$0C,$5A,$0B,$A9,$0B,$01,$0A,$63,$09,$CE,$09,$41,$08,$BC,$08,$3E,$07,$C8,$07,$58,$06,$EF,$06,$8B,$06,$2D,$05,$D4,$05,$81,$05,$32,$04,$E7,$04,$A0,$04,$5E,$04,$1F,$03,$E4,$03,$AC,$03,$77,$03,$46,$03,$17,$02,$EA,$02,$C0,$02,$99,$02,$73,$02,$50,$02,$2F,$02,$10,$01,$F2,$01,$D6,$01,$BC,$01,$A3,$01,$8B,$01,$75,$01,$60,$01,$4C,$01,$3A,$01,$28,$01,$17,$01,$08,$00,$F9,$00,$EB,$00,$DE,$00,$D1,$00,$C6,$00,$BB,$00,$B0,$00,$A6,$00,$9D,$00,$94,$00,$8C,$00,$84,$00,$7D,$00,$76,$00,$6F,$00,$69,$00,$63,$00,$5D,$00,$58,$00,$53,$00,$4E,$00,$4A,$00,$46,$00,$42,$00,$3E,$00,$3B,$00,$37,$00,$34,$00,$31,$00,$2F,$00,$2C,$00,$2A,$00,$27,$00,$25,$00,$23,$00,$21

;j=5
;.db $46,$6F,$42,$7B,$3E,$C0,$3B,$3A,$37,$E7,$34,$C4,$31,$CE,$2F,$02,$2C,$5F,$29,$E1,$27,$88,$25,$50,$23,$38,$21,$3E,$1F,$60,$1D,$9D,$1B,$F4,$1A,$62,$18,$E7,$17,$81,$16,$2F,$14,$F1,$13,$C4,$12,$A8,$11,$9C,$10,$9F,$0F,$B0,$0E,$CF,$0D,$FA,$0D,$31,$0C,$74,$0B,$C1,$0B,$18,$0A,$78,$09,$E2,$09,$54,$08,$CE,$08,$4F,$07,$D8,$07,$67,$06,$FD,$06,$99,$06,$3A,$05,$E0,$05,$8C,$05,$3C,$04,$F1,$04,$AA,$04,$67,$04,$28,$03,$EC,$03,$B4,$03,$7E,$03,$4C,$03,$1D,$02,$F0,$02,$C6,$02,$9E,$02,$78,$02,$55,$02,$33,$02,$14,$01,$F6,$01,$DA,$01,$BF,$01,$A6,$01,$8E,$01,$78,$01,$63,$01,$4F,$01,$3C,$01,$2A,$01,$1A,$01,$0A,$00,$FB,$00,$ED,$00,$E0,$00,$D3,$00,$C7,$00,$BC,$00,$B1,$00,$A8,$00,$9E,$00,$95,$00,$8D,$00,$85,$00,$7E,$00,$76,$00,$70,$00,$6A,$00,$64,$00,$5E,$00,$59,$00,$54,$00,$4F,$00,$4B,$00,$46,$00,$42,$00,$3F,$00,$3B,$00,$38,$00,$35,$00,$32,$00,$2F,$00,$2C,$00,$2A,$00,$28,$00,$25,$00,$23,$00,$21,$00,$1F,$00,$1E,$00,$1C,$00,$1A,$00,$19,$00,$18,$00,$16,$00,$15,$00,$14,$00,$13,$00,$12,$00,$11

;j=2
;.db $47,$47,$43,$47,$3F,$80,$3B,$F0,$38,$92,$35,$66,$32,$66,$2F,$92,$2C,$E7,$2A,$62,$28,$01,$25,$C2,$23,$A3,$21,$A3,$1F,$C0,$1D,$F8,$1C,$49,$1A,$B3,$19,$33,$17,$C9,$16,$73,$15,$31,$14,$00,$12,$E1,$11,$D2,$10,$D2,$0F,$E0,$0E,$FC,$0E,$25,$0D,$59,$0C,$9A,$0B,$E5,$0B,$3A,$0A,$98,$0A,$00,$09,$70,$08,$E9,$08,$69,$07,$F0,$07,$7E,$07,$12,$06,$AD,$06,$4D,$05,$F2,$05,$9D,$05,$4C,$05,$00,$04,$B8,$04,$74,$04,$34,$03,$F8,$03,$BF,$03,$89,$03,$56,$03,$26,$02,$F9,$02,$CE,$02,$A6,$02,$80,$02,$5C,$02,$3A,$02,$1A,$01,$FC,$01,$DF,$01,$C5,$01,$AB,$01,$93,$01,$7D,$01,$67,$01,$53,$01,$40,$01,$2E,$01,$1D,$01,$0D,$00,$FE,$00,$F0,$00,$E2,$00,$D6,$00,$CA,$00,$BE,$00,$B4,$00,$AA,$00,$A0,$00,$97,$00,$8F,$00,$87,$00,$7F,$00,$78,$00,$71,$00,$6B,$00,$65,$00,$5F,$00,$5A,$00,$55,$00,$50,$00,$4C,$00,$47,$00,$43,$00,$40,$00,$3C,$00,$39,$00,$35,$00,$32,$00,$30,$00,$2D,$00,$2A,$00,$28,$00,$26,$00,$24,$00,$22,$00,$20,$00,$1E,$00,$1C,$00,$1B,$00,$19,$00,$18,$00,$16,$00,$15,$00,$14,$00,$13,$00,$12,$00,$11

;j=0
;.db $47,$D6,$43,$CE,$40,$00,$3C,$68,$39,$04,$35,$D1,$32,$CC,$2F,$F2,$2D,$41,$2A,$B7,$28,$51,$26,$0E,$23,$EB,$21,$E7,$20,$00,$1E,$34,$1C,$82,$1A,$E9,$19,$66,$17,$F9,$16,$A1,$15,$5C,$14,$29,$13,$07,$11,$F6,$10,$F4,$10,$00,$0F,$1A,$0E,$41,$0D,$74,$0C,$B3,$0B,$FD,$0B,$50,$0A,$AE,$0A,$14,$09,$83,$08,$FB,$08,$7A,$08,$00,$07,$8D,$07,$21,$06,$BA,$06,$59,$05,$FE,$05,$A8,$05,$57,$05,$0A,$04,$C2,$04,$7D,$04,$3D,$04,$00,$03,$C7,$03,$90,$03,$5D,$03,$2D,$02,$FF,$02,$D4,$02,$AB,$02,$85,$02,$61,$02,$3F,$02,$1E,$02,$00,$01,$E3,$01,$C8,$01,$AF,$01,$96,$01,$80,$01,$6A,$01,$56,$01,$43,$01,$30,$01,$1F,$01,$0F,$01,$00,$00,$F2,$00,$E4,$00,$D7,$00,$CB,$00,$C0,$00,$B5,$00,$AB,$00,$A1,$00,$98,$00,$90,$00,$88,$00,$80,$00,$79,$00,$72,$00,$6C,$00,$66,$00,$60,$00,$5B,$00,$55,$00,$51,$00,$4C,$00,$48,$00,$44,$00,$40,$00,$3C,$00,$39,$00,$36,$00,$33,$00,$30,$00,$2D,$00,$2B,$00,$28,$00,$26,$00,$24,$00,$22,$00,$20,$00,$1E,$00,$1D,$00,$1B,$00,$19,$00,$18,$00,$17,$00,$15,$00,$14,$00,$13,$00,$12,$00,$11

;j=-2
;.db $48,$66,$44,$56,$40,$80,$3C,$E1,$39,$77,$36,$3D,$33,$32,$30,$52,$2D,$9C,$2B,$0C,$28,$A2,$26,$5A,$24,$33,$22,$2B,$20,$40,$1E,$71,$1C,$BB,$1B,$1E,$19,$99,$18,$29,$16,$CE,$15,$86,$14,$51,$13,$2D,$12,$1A,$11,$15,$10,$20,$0F,$38,$0E,$5E,$0D,$8F,$0C,$CC,$0C,$15,$0B,$67,$0A,$C3,$0A,$28,$09,$97,$09,$0D,$08,$8B,$08,$10,$07,$9C,$07,$2F,$06,$C8,$06,$66,$06,$0A,$05,$B3,$05,$62,$05,$14,$04,$CB,$04,$86,$04,$45,$04,$08,$03,$CE,$03,$97,$03,$64,$03,$33,$03,$05,$02,$DA,$02,$B1,$02,$8A,$02,$66,$02,$43,$02,$23,$02,$04,$01,$E7,$01,$CC,$01,$B2,$01,$9A,$01,$83,$01,$6D,$01,$58,$01,$45,$01,$33,$01,$22,$01,$11,$01,$02,$00,$F4,$00,$E6,$00,$D9,$00,$CD,$00,$C1,$00,$B6,$00,$AC,$00,$A3,$00,$99,$00,$91,$00,$89,$00,$81,$00,$7A,$00,$73,$00,$6C,$00,$66,$00,$61,$00,$5B,$00,$56,$00,$51,$00,$4D,$00,$48,$00,$44,$00,$41,$00,$3D,$00,$39,$00,$36,$00,$33,$00,$30,$00,$2E,$00,$2B,$00,$29,$00,$26,$00,$24,$00,$22,$00,$20,$00,$1E,$00,$1D,$00,$1B,$00,$1A,$00,$18,$00,$17,$00,$16,$00,$14,$00,$13,$00,$12,$00,$11

;j=-3
.db $44,$9A,$40,$C0,$3D,$1E,$39,$B0,$36,$73,$33,$64,$30,$82,$2D,$C9,$2B,$37,$28,$CA,$26,$80,$24,$57,$22,$4D,$20,$60,$1E,$8F,$1C,$D8,$1B,$39,$19,$B2,$18,$41,$16,$E5,$15,$9C,$14,$65,$13,$40,$12,$2B,$11,$26,$10,$30,$0F,$47,$0E,$6C,$0D,$9D,$0C,$D9,$0C,$20,$0B,$72,$0A,$CE,$0A,$33,$09,$A0,$09,$16,$08,$93,$08,$18,$07,$A4,$07,$36,$06,$CE,$06,$6D,$06,$10,$05,$B9,$05,$67,$05,$19,$04,$D0,$04,$8B,$04,$4A,$04,$0C,$03,$D2,$03,$9B,$03,$67,$03,$36,$03,$08,$02,$DD,$02,$B3,$02,$8D,$02,$68,$02,$45,$02,$25,$02,$06,$01,$E9,$01,$CD,$01,$B4,$01,$9B,$01,$84,$01,$6E,$01,$5A,$01,$46,$01,$34,$01,$23,$01,$12,$01,$03,$00,$F4,$00,$E7,$00,$DA,$00,$CE,$00,$C2,$00,$B7,$00,$AD,$00,$A3,$00,$9A,$00,$91,$00,$89,$00,$82,$00,$7A,$00,$73,$00,$6D,$00,$67,$00,$61,$00,$5C,$00,$56,$00,$52,$00,$4D,$00,$49,$00,$45,$00,$41,$00,$3D,$00,$3A,$00,$36,$00,$33,$00,$31,$00,$2E,$00,$2B,$00,$29,$00,$27,$00,$24,$00,$22,$00,$20,$00,$1F,$00,$1D,$00,$1B,$00,$1A,$00,$18,$00,$17,$00,$16,$00,$14,$00,$13,$00,$12,$00,$11

;j=4
;.db $48,$F6,$44,$DD,$41,$00,$3D,$5A,$39,$E9,$36,$A9,$33,$97,$30,$B2,$2D,$F6,$2B,$62,$28,$F3,$26,$A6,$24,$7B,$22,$6F,$20,$80,$1E,$AD,$1C,$F4,$1B,$54,$19,$CC,$18,$59,$16,$FB,$15,$B1,$14,$79,$13,$53,$12,$3D,$11,$37,$10,$40,$0F,$57,$0E,$7A,$0D,$AA,$0C,$E6,$0C,$2C,$0B,$7E,$0A,$D8,$0A,$3D,$09,$AA,$09,$1F,$08,$9C,$08,$20,$07,$AB,$07,$3D,$06,$D5,$06,$73,$06,$16,$05,$BF,$05,$6C,$05,$1E,$04,$D5,$04,$8F,$04,$4E,$04,$10,$03,$D6,$03,$9F,$03,$6B,$03,$39,$03,$0B,$02,$DF,$02,$B6,$02,$8F,$02,$6A,$02,$48,$02,$27,$02,$08,$01,$EB,$01,$CF,$01,$B5,$01,$9D,$01,$86,$01,$70,$01,$5B,$01,$48,$01,$35,$01,$24,$01,$13,$01,$04,$00,$F5,$00,$E8,$00,$DB,$00,$CE,$00,$C3,$00,$B8,$00,$AE,$00,$A4,$00,$9B,$00,$92,$00,$8A,$00,$82,$00,$7B,$00,$74,$00,$6D,$00,$67,$00,$61,$00,$5C,$00,$57,$00,$52,$00,$4D,$00,$49,$00,$45,$00,$41,$00,$3D,$00,$3A,$00,$37,$00,$34,$00,$31,$00,$2E,$00,$2B,$00,$29,$00,$27,$00,$24,$00,$22,$00,$21,$00,$1F,$00,$1D,$00,$1B,$00,$1A,$00,$18,$00,$17,$00,$16,$00,$14,$00,$13,$00,$12,$00,$11





.org 640
modLookup:
.db 127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127
.db 127,127,127,128,128,128,128,128,128,128,128,128,128,128,127,127,127,127,127,126,126,126,126,126,126,126,126,126,126,126,127,127
.db 127,127,128,128,128,129,129,129,129,129,129,129,128,128,128,127,127,127,126,126,126,125,125,125,125,125,125,125,126,126,126,127
.db 127,128,128,129,129,129,130,130,130,130,130,129,129,129,128,128,127,126,126,125,125,125,124,124,124,124,124,125,125,125,126,126
.db 127,128,129,129,130,130,131,131,131,131,131,130,130,129,129,128,127,126,125,125,124,124,123,123,123,123,123,124,124,125,125,126
.db 127,128,129,130,131,131,132,132,132,132,132,131,131,130,129,128,127,126,125,124,123,123,122,122,122,122,122,123,123,124,125,126
.db 127,128,129,130,131,132,133,133,133,133,133,132,131,130,129,128,127,126,125,124,123,122,121,121,121,121,121,122,123,124,125,126
.db 127,128,130,131,132,133,133,134,134,134,133,133,132,131,130,128,127,126,124,123,122,121,121,120,120,120,121,121,122,123,124,126
